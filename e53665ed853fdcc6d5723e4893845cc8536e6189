{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "202d04db_4ded54c8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1010110
      },
      "writtenOn": "2020-10-06T06:26:21Z",
      "side": 1,
      "message": "This should resolve adb remount issue.",
      "revId": "e53665ed853fdcc6d5723e4893845cc8536e6189",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4b79474e_f4273a7f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1031448
      },
      "writtenOn": "2020-10-06T09:48:31Z",
      "side": 1,
      "message": "Verified with 5.4.38-01037-g307fef1b71be.\n\nNot much luck with android-mainline build.\n\nIf selinux\u003dpermissive, \"adb remount\" and \"adb sync\" works with 5.9.0-rc7-mainline-00003-g0bbae53bf635 too. But runs into kernel panic at {security,selinux}_file_permission for any file operation (e.g ls) and boot loops with same kernel panic.\n\nIf selinux is in enforcing mode, then \"adb remount\" runs into the kernel panic at {security,selinux}_inode_getattr. https://android-review.googlesource.com/c/kernel/common/+/1448816 does help and there is no kernel panic on \"adb remount\". \"adb sync\" works as well but db845c doesn\u0027t come up on next boot and runs into a boot loop https://pastebin.ubuntu.com/p/M8mhZBFxZS/. Fixing the overlayfs_file selinux denial in the log above didn\u0027t help and we run into boot loop again with \"Abort message: \u0027Check failed: serviceManager Could not retrieve ServiceManager\u0027\".",
      "revId": "e53665ed853fdcc6d5723e4893845cc8536e6189",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "158c3c8d_53fb3c33",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1031448
      },
      "writtenOn": "2020-10-06T16:01:47Z",
      "side": 1,
      "message": "I\u0027m OK to merge this patch to unblock android12-5.4 users and follow up on android-mainline failures separately.",
      "revId": "e53665ed853fdcc6d5723e4893845cc8536e6189",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6adaee70_d1e6f113",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1010110
      },
      "writtenOn": "2020-10-06T18:25:11Z",
      "side": 1,
      "message": "Bummer.  I did some testing w/ my personal mainline-WIP tree, and didn\u0027t see this. I\u0027ll try to reproduce and dig a bit.",
      "parentUuid": "4b79474e_f4273a7f",
      "revId": "e53665ed853fdcc6d5723e4893845cc8536e6189",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04affb3d_7d096140",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1010110
      },
      "writtenOn": "2020-10-06T20:41:14Z",
      "side": 1,
      "message": "Amit: So I can\u0027t seem reproduce this with android-mainline (5.9.0-rc8-mainline-00150-gd47a4b6ba183). Can you provide any more details as the exact steps your using to trigger this? Can you try with the newer kernel as well?",
      "parentUuid": "6adaee70_d1e6f113",
      "revId": "e53665ed853fdcc6d5723e4893845cc8536e6189",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b77203cd_dc43f37f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1067098
      },
      "writtenOn": "2020-10-07T00:49:54Z",
      "side": 1,
      "message": "I\u0027ve been seeing many of the same symptoms as Amit. Here\u0027s my recipe for reproducing:\n\n1. m installclean\n2. m\n3. flash boot/super/cache/userdata\n4. adb root\n5. adb remount\n6. adb reboot\n7. make a change to libc\n8. m\n9. adb root\n10. adb remount\n11. adb sync\n12. adb reboot\n\nWith that and after patching in the kernel panic fix found by Amit (aosp/1448816) my serial console output looks a lot like Amit\u0027s: https://pastebin.ubuntu.com/p/hYGhDf7XHh/\n\nFixing the selinux denials like so:\n\ndiff --git a/system/sepolicy/public/init.te b/system/sepolicy/public/init.te\nindex f84bacbf5f..43d269b95a 100644\n--- a/system/sepolicy/public/init.te\n+++ b/system/sepolicy/public/init.te\n@@ -335,7 +335,8 @@ allow init proc_filesystems:file r_file_perms;\n userdebug_or_eng(`\n   # Overlayfs workdir write access check during mount to permit remount,rw\n   allow init overlayfs_file:dir { relabelfrom mounton write };\n-  allow init overlayfs_file:file { append };\n+  allow init overlayfs_file:file { append rename };\n+  allow init overlayfs_file:chr_file { unlink };\n   allow init system_block_device:blk_file { write };\n \u0027)\n \n\ndoesn\u0027t help much; I still see a very similar console output (including init being unable to exec anything with \"Operation not permitted\").\n\nI also tried kernel version 5.4 by unsetting TARGET_KERNEL_USE. With that and following the recipe above the boot succeeds and I can see my changes to libc on the device. Unfortunately I need to work with the mainline kernel and not 5.4 so this doesn\u0027t help me very much.",
      "parentUuid": "04affb3d_7d096140",
      "revId": "e53665ed853fdcc6d5723e4893845cc8536e6189",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c025c07_662fd3b6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1067098
      },
      "writtenOn": "2020-10-07T02:09:16Z",
      "side": 1,
      "message": "I can also repro with an unmodified 5.9.0-rc8-mainline-00150-gd47a4b6ba183 kernel. For some reason I only need to follow steps 1-6 with the newer kernel. Here\u0027s the serial output with that kernel: https://pastebin.ubuntu.com/p/PQ3tqHPkMD/",
      "parentUuid": "b77203cd_dc43f37f",
      "revId": "e53665ed853fdcc6d5723e4893845cc8536e6189",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e5607a5_f2a28111",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1010110
      },
      "writtenOn": "2020-10-07T03:10:07Z",
      "side": 1,
      "message": "From your log, it almost looks like keymaster isn\u0027t starting up properly. I\u0027ll dig a bit tonight on that.\n\n\n init: starting service \u0027vendor.keymaster-3-0\u0027...\n init: cannot execv(\u0027/vendor/bin/hw/android.hardware.keymaster@3.0-service\u0027). See the \u0027Debugging init\u0027 section of init\u0027s README.md for tips: Operation not permitted\n init: Service \u0027system_suspend\u0027 (pid 301) exited with status 127\n init: Sending signal 9 to service \u0027system_suspend\u0027 (pid 301) process group...\n libprocessgroup: Successfully killed process cgroup uid 1000 pid 301 in 0ms\n init: Service \u0027vendor.keymaster-3-0\u0027 (pid 302) exited with status 127\n init: Sending signal 9 to service \u0027vendor.keymaster-3-0\u0027 (pid 302) process group...",
      "parentUuid": "3c025c07_662fd3b6",
      "revId": "e53665ed853fdcc6d5723e4893845cc8536e6189",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}